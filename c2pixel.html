<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>十六进制到像素转换工具</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background-color: #f0f0f0;
            font-family: Arial, sans-serif;
        }

        #inputArea {
            width: 100%;
            max-width: 800px;
            margin: 20px auto;
        }

        textarea {
            width: 100%;
            height: 150px;
            padding: 10px;
            font-family: Consolas, monospace;
            border: 2px solid #4CAF50;
            border-radius: 4px;
            resize: vertical;
        }

        #previewCanvas {
            margin: 0 auto;
            display: block;
            border: 2px solid #2196F3;
            background: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            flex-shrink: 0;
        }
    </style>
</head>

<body>
    <div><canvas id="previewCanvas"></canvas></div>
    <div id="inputArea">
        <div class="dimension-inputs">
            <label>宽度:</label>
            <input type="number" id="widthInput" value="128" min="1">
            <label>高度:</label>
            <input type="number" id="heightInput" value="64" min="1">
        </div>
        <textarea id="hexInput" placeholder="请输入十六进制数据（例如：0xFF 0x00...）"></textarea>
    </div>

    <script>
        // 初始化画布和上下文
        const canvas = document.getElementById('previewCanvas');
        const ctx = canvas.getContext('2d');
        const input = document.getElementById('hexInput');
        const widthInput = document.getElementById('widthInput');
        const heightInput = document.getElementById('heightInput');

        // 点阵参数配置
        const DOT_SIZE = 4;
        let canvasWidth = 128;
        let canvasHeight = 64;
        const BYTE_BITS = 8;

        function parseHexArray(text) {
            return text.match(/0x[0-9A-Fa-f]{1,2}/g) || [];
        }

        function drawBitmap() {

            const hexValues = parseHexArray(input.value);
            const bytes = hexValues.map(v => parseInt(v, 16));
            // 设置画布尺寸
            canvas.width = parseInt(widthInput.value) * DOT_SIZE;
            canvas.height = parseInt(heightInput.value) * DOT_SIZE;

            ctx.fillStyle = '#000';

            const width = parseInt(widthInput.value);
            const height = parseInt(heightInput.value);

            let x = 0;
            let y = 0;

            // 遍历每个字节
            for (let byteIndex = 0; byteIndex < bytes.length; byteIndex++) {
                // x = byteIndex* BYTE_BITS % width;
                // y =  Math.floor(byteIndex * BYTE_BITS  / width);
                // x = Math.floor((byteIndex / height)) * BYTE_BITS;
                // y = byteIndex % height;

                // 遍历字节中的每一位
                for (let bit = 0; bit < 8; bit++) {
                    if (bytes[byteIndex] & (0x80 >> bit)) {
                        ctx.fillRect(
                            x * DOT_SIZE,
                            (y + (BYTE_BITS - bit - 1)) * DOT_SIZE,
                            DOT_SIZE - 1,
                            DOT_SIZE - 1
                        );
                    }
                }
                x++;
                if (x >= width) {
                    x = 0;
                    y += BYTE_BITS;
                }
                // if (y >= height) break;
            }
        }

        // 监听宽度和高度输入变化

        widthInput.addEventListener('input', () => {
            canvas.width = parseInt(widthInput.value) * DOT_SIZE;
            drawBitmap();
        });

        heightInput.addEventListener('input', () => {
            canvas.height = parseInt(heightInput.value) * DOT_SIZE;
            drawBitmap();
        });

        input.addEventListener('input', () => {
            try {
                drawBitmap();
            } catch (e) {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
            }
        });

        // 初始化时清空画布
        ctx.clearRect(0, 0, canvas.width, canvas.height);
    </script>
</body>

</html>